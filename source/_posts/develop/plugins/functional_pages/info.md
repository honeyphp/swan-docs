---
title: 插件功能页
header: develop
nav: plugins
sidebar: functional_pages
---

插件功能页从小程序基础库版本 3.120.2 开始支持。

介于安全考虑，插件中使用一些功能需要用户授权后操作，某些接口不能在插件中直接调用，但插件开发者可以使用插件功能页的方式来实现功能。目前，插件功能页包括：

1. 获取用户信息，包括 openid 和昵称等（相当于 swan.login 和 swan.getUserInfo 的功能），详见用户信息功能页；
2. 支付（相当于 swan.requestPayment），详见支付功能页；
3. 获取收货地址（相当于 swan.chooseAddress），详见收货地址功能页。

要使用插件功能页，需要先激活功能页特性，配置对应的功能页函数，再使用 functional-page-navigator 组件跳转到插件功能页，从而实现对应的功能。详情请参考下文。

## 插件所有者小程序
开始开发之前，我们需要知道，插件功能页是指 插件所有者小程序 中的一个特殊页面。

插件所有者小程序，指的是与插件 AppID 相同的小程序。例如，“小程序示例”小程序开发了一个“小程序示例插件”，那么无论这个插件被哪个小程序使用，这个插件的 插件所有者小程序 都是“小程序示例”。下文中会继续使用 插件所有者小程序 这个说法。

## 插件所有者小程序开发方法
通常，在开始使用插件功能页的时候，需要开启两个开发者工具窗口，其中一个打开插件项目，另一个打开插件所有者小程序的小程序项目。例如，一个打开“小程序示例插件”项目，另一个打开“小程序示例”项目。

这两个窗口，前者用于编辑插件，后者用于编辑插件所有者小程序。下文中所有需要编辑插件所有者小程序的内容，都是在后者中进行。

## 激活功能页特性
要在插件中调用插件功能页，需要先激活插件所有者小程序的功能页特性。具体来说，在插件所有者小程序的 app.json 文件中添加 functionalPages 定义段，并令其值为 true ，例如：

代码示例：
```
{
  "functionalPages": {
    "independent": true
  }
}
```

插件功能页的代码独立于其他代码，这意味着插件功能页可以被独立下载、加载，具有更好的性能表现。 但也同时使得插件功能页目录 functional-pages/ （支付功能页会使用其中的文件）不能 require 这个目录以外的文件（反之亦然：这个目录以外的文件也不能调用这个目录内的）。

注意，新增或改变这个字段时，需要这个小程序发布新版本，才能在正式环境中使用插件功能页。

## 跳转到功能页
功能页不能使用 swan.navigateTo 来进行跳转，而是需要一个名为 functional-page-navigator 的组件。以获取用户信息为例，可以在插件中放置如下的 functional-page-navigator：

代码示例：

```
<functional-page-navigator name="loginAndGetUserInfo" args="" version="develop" bind:success="loginSuccess">
  <button>登录到插件</button>
</functional-page-navigator>
```

用户在点击这个 navigator 时，会自动跳转到插件所有者小程序的对应功能页。功能页会提示用户进行登录或其他相应的操作。操作结果会以组件事件的方式返回。

functional-page-navigator 的参数和详细使用方法可以参考组件说明 。


## 真机开发测试的常规步骤
目前，功能页的跳转目前不支持在开发者工具中调试，请在真机上测试。初次进行真机开发测试时，通常步骤如下：

1. 在开发者工具上打开插件所有者小程序项目，并点击“预览”；
2. 用测试用的真机扫一下预览二维码，此时会进入插件所有者小程序，进入后就可以直接退出这个小程序；
3. 在开发者工具上打开插件项目，将插件中 functional-page-navigator 中的 version 属性设置为 develop；
4. 点击预览可以生成插件预览二维码，用测试用的真机扫码即可预览功能页；如果更改了插件代码，重新生成并扫描插件的预览二维码即可；
5. 如果过了一段时间之后，跳转功能页时出现“开发版已过期”这样的提示，从第1步开始重试一次。

注意：functional-page-navigator 的 version=develop 仅用于调试，因此在插件提审前，需要：

1. 确保已发布激活了插件功能页特性的插件所有者小程序；
2. 确保所有的 functional-page-navigator 组件属性设置为 version="release" 。


## Tips
1. 功能页是插件所有者小程序中的一个特殊页面，开发者不能自定义这个页面的外观。
2. 插件所有者小程序本身也可以引用这个插件，此时，functional-page-navigator 组件的 version 属性将不会生效，而是取决于当前运行的插件所有者小程序的版本。
3. functional-page-navigator 可以在开发者工具中使用，但功能页的跳转目前不支持在开发者工具中调试，请在真机上测试。